---
title: "Exploiting Dependency Confusion"
date: 2021-06-01 13:37:31
description: Exploiting Dependency Confusion
---

In this blog, We will step by step exploit a demo application vulnerable to Dependency Confusion attack. 

This blog is not about what dependency confusion is, that you can read [here](https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610).

## Introduction to demo app

Our demo application is a simple app with only Backend and Frontend. The application allows User from frontend to check if a string have XSS payload in it or not.

### Backend

Backend is running on http://demo-app.com:1337. 

There is an API endpoint `http://demo-app.com:1337/?text=PAYLOAD` that checks for XSS payload in it.

![](/website/assets/images/dep-conf-1.png)

### Frontend

Frontend is running on http://demo-app.com:3000

The Frontend takes a query parameter "text". It then hits the backend API with that query parameter text, looks for XSS in that text and displays the result on Screen (see below)

![](/website/assets/images/dep-conf-2.png)

![](/website/assets/images/dep-conf-3.png)


## Overview Dependency Confusion

To Find if an application is vulnerable to Dependency confusion, our first step is to find all the possible packages the web application is using.  

### What are packages?

We can think of packages as `Developers sharing code for other developers to reuse it`. 

For example, If a developer develops a mongo database wrapper to enable mongoDB connection, he can make a package and publish it online(at central repository) and other people can reuse them. 

Now, In case you do not want to share your package with everyone in the world but keep it secret to people in your organization you can host your packages on a private organization repo and only people in your organization can use it. For example. Lets say you have a custom authentication process which you think everyone can use in your company. Making it public will not be a good idea. So there is also a concept of private repositories where developers can share private packages. 

Our goal as an attacker is to find as many packages as possible used in Frontend/Backend and find the once that are private to the organization. Once we know all private packages, we can host them on npm and the web application will download our package instead of private package(thats how this vulnerability works).

## Exploiting demo app

### Step 1

Find Packages installed in backend application. To do this we will need to leak package.json file somehow or if we can leak application’s source code. Some ways to do it:

* Directory brute force for for sensitive information leak
    * http://site.com/.git can leak full source
    * http://site.com/package.json maybe we can just read package.json

* If the application is vulnerable to Local file disclosure, we can use it to leak package.json 
    * http://site.com/?file=../../../package.json

* OSINT
    * If its open source app, you can try finding the source code on github and see packages used

etc.. The goal here is to use your hacker instinct to find the leak and get the information about packages installed.

Following the above steps, running dirsearch on our demo application backend(http://demo-app:1337/) show’s the following result:

![](/website/assets/images/dep-conf-4.png)

So we can see the package.json file is exposed. It lists following packages installed.
![](/website/assets/images/dep-conf-5.png)

### Step 2

Find packages installed in the Frontend application. We can do this in following ways:
* Reviewing frontend source code and look for required packages. Look for the term `require()` or `import` in the source code

    ![](/website/assets/images/dep-conf-6.png)

* Frontend Application might be returning `node_modules` folders back to user. Some application do that in debug mode

    ![](/website/assets/images/dep-conf-9.png)


etc.. Again, the goal is to use your hacker instincsts and find the packages.

### Step 3

List all the packages 

* Frontend
    * react
    * ez-get-url-params [looks suspecious]
    * react-dom
    * react-refresh
    * url
    ...

* Backend
    * body-parser
    * express
    * xss-finder-0xsapra [looks suspecious]


### Step 4

Now that we have a list of all the packages used in the application, next step is to find which one of them are `not` on `npm`. We can simply do this by visiting https://www.npmjs.com/ and search for package name. 

So 2 packages which I cant find are:

* xss-finder-0xsapra
![](/website/assets/images/dep-conf-7.png)

* ez-get-url-params
![](/website/assets/images/dep-conf-8.png)

Meaning these are private packages.

### Step 5

Upload the package with similar name  `xss-finder-0xsapra` or `ez-get-url-params` on NPM(with preinstall scripts to get RCE).



## Conslusion

Following the above 5 steps, you should be able to properly test a application for dependency confusion vulnerability. 

I Hope this clears the attack. 